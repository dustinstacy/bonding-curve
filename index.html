<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Prices Graph</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #graphContainer {
            width: 80%;
            margin: auto;
            padding: 20px;
        }
        canvas {
            border: 1px solid #ccc;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4;
        }
    </style>
</head>
<body>
    <h1>Token Prices Over Time</h1>
    <div id="graphContainer">
        <canvas id="priceChart" width="800" height="400"></canvas>
    </div>

    <!-- Table to display token prices -->
    <div id="tableContainer">
        <table id="priceTable">
            <thead>
                <tr>
                    <th>Token</th>
                    <th>Price (Wei)</th>
                    <th>Price (USD)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data rows will be inserted here dynamically -->
            </tbody>
        </table>
    </div>

    <script>
        // Fetch the JSON data from the file
        fetch('script/data/graphData.json')
            .then(response => response.json())
            .then(jsonData => {
                // Extract data for the chart and table
                const tokens = jsonData.data.map(entry => entry.token);
                const pricesInWei = jsonData.data.map(entry => entry.priceInWei);
                const prices = jsonData.data.map(entry => entry.price);

                // Create the chart
                const canvas = document.getElementById('priceChart');
                const ctx = canvas.getContext('2d');
                const padding = 50; // padding around the edges
                const width = canvas.width - 2 * padding;
                const height = canvas.height - 2 * padding;
                const maxPrice = 1000000;
                const minPrice = Math.min(...prices);
                const maxToken = Math.max(...tokens);
                
                const xInterval = 10; // Interval for X axis
                const yInterval = 100000; // Interval for Y axis

                // Draw X and Y axes
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height + padding);
                ctx.lineTo(width + padding, height + padding);
                ctx.stroke();

                // Draw X axis intervals and labels
                ctx.beginPath();
                ctx.strokeStyle = 'black';
                ctx.font = '12px Arial';
                for (let i = 0; i <= maxToken; i += xInterval) {
                    const x = padding + (i / maxToken) * width;
                    ctx.moveTo(x, height + padding);
                    ctx.lineTo(x, height + padding + 5); // Tick marks
                    ctx.fillText(i, x - 10, height + padding + 20); // Labels
                }
                ctx.stroke();

                // Draw Y axis intervals and labels
                ctx.beginPath();
                for (let i = Math.floor(minPrice / yInterval) * yInterval; i <= maxPrice; i += yInterval) {
                    const y = height + padding - ((i - minPrice) / (maxPrice - minPrice)) * height;
                    ctx.moveTo(padding, y);
                    ctx.lineTo(padding - 5, y); // Tick marks
                    ctx.fillText('$' + (i / 10000).toFixed(2), padding - 50, y + 5); // Labels
                }
                ctx.stroke();

                // Draw lines
                ctx.beginPath();
                ctx.moveTo(padding + (tokens[0] / maxToken) * width, height + padding - ((prices[0] - minPrice) / (maxPrice - minPrice)) * height);
                for (let i = 1; i < tokens.length; i++) {
                    const x = padding + (tokens[i] / maxToken) * width;
                    const y = height + padding - ((prices[i] - minPrice) / (maxPrice - minPrice)) * height;
                    ctx.lineTo(x, y);
                }
                ctx.strokeStyle = 'blue';
                ctx.stroke();

                // Add axis labels
                ctx.fillStyle = 'black';
                ctx.font = '12px Arial';
                ctx.fillText('Token', width / 2 + padding, height + padding + 30);
                ctx.save();
                ctx.translate(padding - 20, height / 2 + padding);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText('Price (USD)', 0, 0);
                ctx.restore();

                // Populate the table
                const tableBody = document.querySelector('#priceTable tbody');
                tokens.forEach((token, index) => {
                    const row = document.createElement('tr');
                    const priceInWei = pricesInWei[index];
                    const priceInUSD = (prices[index] / 10000).toFixed(2); // Convert price to dollars with 2 decimal places
                    row.innerHTML = `
                        <td>${token}</td>
                        <td>${priceInWei}</td>
                        <td>$${priceInUSD}</td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching JSON data:', error));
    </script>
</body>
</html>
